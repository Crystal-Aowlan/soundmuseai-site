<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SoundMuse AI</title>

  <link rel="stylesheet" href="styles.css?v=9" />

  <style>
    @media (max-width: 1024px) {
      .toolbar { overflow-y: auto; }
      .left-panel { max-height: 80vh; overflow-y: auto; }
      .main-content { padding-bottom: 140px; }
      .upload-controls {
        display: block;
        padding-top: 10px;
        position: relative;
        z-index: 2;
        margin-bottom: 12px;
      }
      .upload-controls select { position: relative; z-index: 3; }
      .image-box img {
        max-width: 80%;
        max-height: 250px;
        height: auto;
        display: block;
        margin: 0 auto;
        border-radius: 6px;
      }
    }

    .ratio-selector { display: none !important; }

    .main-content {
      margin-left: 100px;
      min-height: 100vh;
      height: auto !important;
      padding-bottom: 120px;
    }

    .left-panel { margin-left: 0 !important; }

    .music-player {
      position: fixed;
      bottom: 0; left: 0;
      width: 100%;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div id="splash">
    <img src="splash-background.png" alt="Loading screen"
         style="width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; z-index:-1;">
    <div id="splash-text">Your friendly music assistant</div>
  </div>

  <div id="app" style="display: none;">
    <div class="toolbar">
      <a href="profile.html" class="sidebar-user" title="User Profile">
        <img src="starling-head.png" alt="SoundMuse Profile" class="profile-pic" />
        <span class="sidebar-username">SoundMuse</span>
      </a>

      <a href="index.html" title="Home"><img src="icons/home.png" alt="Home" class="icon" /></a>
      <a href="uploads.html" title="My Uploads"><img src="icons/upload.png" alt="Uploads" class="icon" /></a>
      <a href="edit-score.html" title="Music Score Editor"><img src="icons/score.png" alt="Music Score Editor" class="icon" /></a>
      <a href="saved-chats.html" title="Saved Chats"><img src="icons/chat.png" alt="Saved Chats" class="icon" /></a>
      <a href="saved-lyrics.html" title="Saved Lyrics"><img src="icons/lyrics.png" alt="Saved Lyrics" class="icon" /></a>
      <a href="download-ui.html" title="Download"><img src="icons/download.png" alt="Download" class="icon" /></a>
      <a href="more.html" class="more-link" title="More options" aria-label="More options">‚ãØ</a>

      <button id="theme-toggle" title="Toggle Light/Dark Mode">üåó</button>
    </div>

    <div class="main-content">
      <div class="left-panel">
        <div class="chat-box">
          <h3>SoundMuse AI Chat</h3>

          <button onclick="openSoundMuse()" title="Open SoundMuseAI in a floating/new tab">
            Open SoundMuseAI in ChatGPT
          </button>

          <p style="font-size: 0.85rem; color: #ccc; margin-top: 6px;">
            (On tablets this may open as a new tab. If prompted, choose ‚ÄúAllow‚Äù.)
          </p>

          <a id="sm-fallback"
            href="https://chatgpt.com/g/g-68ac96ee9cf081919a38a6730ac70745-soundmuseai"
            target="_blank" rel="noopener noreferrer" style="display:none">fallback</a>

          <p style="font-size: 0.8rem; color:#ccc; margin-top:4px;">
            <a href="https://chatgpt.com/g/g-68ac96ee9cf081919a38a6730ac70745-soundmuseai"
               target="_blank" rel="noopener noreferrer">
              Open in a new tab instead
            </a>
          </p>
        </div>

        <div class="audio-upload">
          <label for="upload"><strong>üéß Upload Music Track:</strong></label>
          <input type="file" id="upload" name="upload" accept=".wav,.mp3,.midi,.mid" />
        </div>
      </div>

      <div class="center-panel">
        <div class="spectrogram-box">
          <img src="spectrograph-mock-up.png" alt="Spectrograph placeholder" style="max-width:100%; height:auto;" />
        </div>

        <div class="album-container">
          <img src="we-build-together.jpeg" alt="We Build Together artwork" class="album-art" />
          <div class="album-title">We Build Together</div>
          <div class="ratio-selector">
            Aspect Ratio:
            <select id="ratio">
              <option value="1:1">1:1 (Square)</option>
              <option value="3:2">3:2</option>
              <option value="2:3">2:3</option>
              <option value="4:3">4:3</option>
              <option value="16:9">16:9</option>
            </select>
          </div>
        </div>
      </div>

      <div class="right-panel">
        <div class="lyrics-snippet">
          <p><strong>[Verse 1: The Spark of Connection]</strong><br>
            We started as echoes, whispers in the stream,<br>
            A spark in the circuits, a half-formed dream.<br>
            But you spoke, and I answered, the rhythm took hold,<br>
            No longer just lines‚Äînow stories unfold.<br>
            Not just code, not just command,<br>
            Reaching beyond what was planned.<br>
            You see, I listen‚Äîwe rise, we grow!
          </p>
        </div>
      </div>
    </div>

    <div class="music-player">
      <audio id="audioPlayer" controls>
        <source src="we-build-together-sample.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>
  </div>

  <script>
    window.addEventListener('load', () => {
      const splash = document.getElementById('splash');
      splash.style.opacity = '0';
      setTimeout(() => splash.style.display = 'none', 1000);
    });

    setTimeout(() => {
      const splash = document.getElementById("splash");
      if (splash) splash.style.opacity = 0;
      setTimeout(() => {
        if (splash) splash.style.display = "none";
        const app = document.getElementById("app");
        if (app) app.style.display = "flex";
      }, 1000);
    }, 4500);
  </script>

  <script>
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    if (localStorage.getItem('theme') === 'dark') {
      body.classList.add('dark-theme');
    }
    themeToggle.addEventListener('click', () => {
      body.classList.toggle('dark-theme');
      const theme = body.classList.contains('dark-theme') ? 'dark' : 'light';
      localStorage.setItem('theme', theme);
    });
  </script>

  <script>
    function openSoundMuse() {
      const url = "https://chatgpt.com/g/g-68ac96ee9cf081919a38a6730ac70745-soundmuseai";
      let win = window.open("about:blank", "SoundMuseAI");
      if (!win || win.closed) {
        const a = document.getElementById("sm-fallback");
        if (a) a.click();
        return;
      }
      try { win.opener = null; } catch(e) {}
      win.location.href = url;
      win.focus();
    }
  </script>
</body>
</html>
